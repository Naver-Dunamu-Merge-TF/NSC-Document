<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSC Payment Prototype</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* 보안 키패드 애니메이션 */
        .keypad-btn:active {
            background-color: #e5e7eb;
            transform: scale(0.95);
        }

        /* 로딩 스피너 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #03C75A;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* 페이드 인 애니메이션 */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 슬라이드 인 애니메이션 */
        .slide-in-center {
            animation: slideInCenter 0.4s ease-out forwards;
        }

        @keyframes slideInCenter {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
    </style>
</head>

<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icons ---
        const IconX = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18" /><path d="m6 6 18 12" /></svg>;
        const IconLock = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2" /><path d="M7 11V7a5 5 0 0 1 10 0v4" /></svg>;
        const IconCheckCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#03C75A" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><path d="m9 11 3 3L22 4" /></svg>;
        const IconShield = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10Z" /></svg>;

        // --- Components ---

        // 숫자 포맷터
        const formatNum = (n) => n.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");

        const App = () => {
            // 상태 관리
            const [step, setStep] = useState('input'); // input -> processing -> success
            const [pin, setPin] = useState('');

            // Mock Data (주문 정보)
            const orderInfo = {
                merchant: "네이버 쇼핑 (스마트스토어)",
                product: "나이키 에어포스 1 '07",
                amount: 15000, // 결제 금액
                userBalance: 1000000 // 현재 잔액
            };

            // 키패드 입력 로직
            const handleKeyPad = (num) => {
                if (step !== 'input') return;
                if (num === 'back') {
                    setPin(prev => prev.slice(0, -1));
                } else if (pin.length < 6) {
                    setPin(prev => prev + num);
                }
            };

            // 결제 승인 버튼 클릭 핸들러 (수정됨: disabled 제거)
            const handlePayment = () => {
                // 6자리가 아닐 경우 명시적인 피드백 제공
                if (pin.length !== 6) {
                    alert("보안을 위해 결제 비밀번호 6자리를 모두 입력해주세요.");
                    return;
                }

                // 1. 처리 중 상태로 변경
                console.log("결제 요청 시작: Freeze Request");
                setStep('processing');
            };

            // 화면 전환 효과 (useEffect 사용으로 안정성 강화)
            useEffect(() => {
                if (step === 'processing') {
                    // 2. 백엔드 통신 시뮬레이션 (2초 후 완료)
                    const timer = setTimeout(() => {
                        console.log("결제 완료: Settle Completed");
                        setStep('success');
                    }, 2000);

                    return () => clearTimeout(timer); // 컴포넌트 언마운트 시 타이머 정리
                }
            }, [step]);

            // 초기화
            const handleReset = () => {
                setStep('input');
                setPin('');
            };

            // 버튼 활성화 상태 확인
            const isReady = pin.length === 6;

            return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    {/* 모바일 프레임 */}
                    <div className="w-full max-w-md bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-200 h-[800px] flex flex-col relative">

                        {/* 상단 헤더 */}
                        <div className="flex justify-between items-center p-6 border-b border-gray-100">
                            <h2 className="text-lg font-bold text-gray-800">결제 요청</h2>
                            <button className="text-gray-400 hover:text-gray-600">
                                <IconX />
                            </button>
                        </div>

                        {/* --- STEP 1: 결제 입력 화면 --- */}
                        {step === 'input' && (
                            <div className="flex-1 flex flex-col bg-gray-50 slide-in-center">
                                {/* 주문 정보 카드 */}
                                <div className="bg-white p-8 m-4 rounded-2xl shadow-sm border border-gray-100 text-center">
                                    <p className="text-gray-500 text-sm mb-2">{orderInfo.merchant}</p>
                                    <h3 className="text-2xl font-bold text-gray-900 mb-1">{orderInfo.product}</h3>
                                    <div className="text-3xl font-extrabold text-[#03C75A] my-4">
                                        {formatNum(orderInfo.amount)} <span className="text-lg text-gray-500 font-normal">NSC</span>
                                    </div>

                                    <div className="h-px bg-gray-100 my-4"></div>

                                    <div className="flex justify-between text-sm">
                                        <span className="text-gray-500">현재 잔액</span>
                                        <span className="font-bold text-gray-700">{formatNum(orderInfo.userBalance)} NSC</span>
                                    </div>
                                    <div className="flex justify-between text-sm mt-2">
                                        <span className="text-gray-500">결제 후 예상 잔액</span>
                                        <span className="font-bold text-blue-600">{formatNum(orderInfo.userBalance - orderInfo.amount)} NSC</span>
                                    </div>
                                </div>

                                {/* PIN 입력 디스플레이 (Dots) */}
                                <div className="flex justify-center gap-4 my-6">
                                    {[...Array(6)].map((_, i) => (
                                        <div key={i} className={`w-4 h-4 rounded-full transition-all ${i < pin.length ? 'bg-[#03C75A]' : 'bg-gray-300'
                                            }`}></div>
                                    ))}
                                </div>

                                <div className="mt-auto bg-white rounded-t-3xl shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                                    {/* 보안 메시지 */}
                                    <div className="flex justify-center items-center gap-2 py-3 border-b border-gray-100 text-xs text-gray-400">
                                        <IconShield />
                                        <span>네이버파이낸셜 보안 키보드 작동 중</span>
                                    </div>

                                    {/* 숫자 키패드 */}
                                    <div className="grid grid-cols-3 text-center">
                                        {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
                                            <button key={num} onClick={() => handleKeyPad(num.toString())} className="keypad-btn py-6 text-2xl font-medium text-gray-700 active:bg-gray-100">
                                                {num}
                                            </button>
                                        ))}
                                        <div className="py-6 bg-gray-50"></div>
                                        <button onClick={() => handleKeyPad('0')} className="keypad-btn py-6 text-2xl font-medium text-gray-700 active:bg-gray-100">0</button>
                                        <button onClick={() => handleKeyPad('back')} className="keypad-btn py-6 flex justify-center items-center active:bg-gray-100">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z" /><line x1="18" x2="12" y1="9" y2="15" /><line x1="12" x2="18" y1="9" y2="15" /></svg>
                                        </button>
                                    </div>

                                    {/* 결제 버튼 (수정됨: 항상 클릭 가능하게 변경) */}
                                    <div className="p-4 bg-white">
                                        <button
                                            onClick={handlePayment}
                                            className={`w-full py-4 rounded-xl font-bold text-lg text-white transition-colors ${isReady ? 'bg-[#03C75A] hover:bg-[#02b350]' : 'bg-gray-300 hover:bg-gray-400'
                                                }`}
                                        >
                                            {isReady ? '결제 승인' : '비밀번호를 입력해주세요'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* --- STEP 2: 처리 중 (Processing) --- */}
                        {step === 'processing' && (
                            <div className="flex-1 flex flex-col items-center justify-center bg-white slide-in-center">
                                <div className="loader mb-6"></div>
                                <h3 className="text-xl font-bold text-gray-800 mb-2">결제 처리 중입니다</h3>
                                <p className="text-gray-500 text-sm">잠시만 기다려 주세요...</p>
                                <div className="mt-8 bg-orange-50 px-4 py-2 rounded-lg border border-orange-100 flex items-center gap-2">
                                    <div className="text-orange-500"><IconLock /></div>
                                    <span className="text-orange-600 text-xs font-bold">안전한 거래를 위해 자산을 동결(Freeze) 중입니다.</span>
                                </div>
                            </div>
                        )}

                        {/* --- STEP 3: 완료 (Success) --- */}
                        {step === 'success' && (
                            <div className="flex-1 flex flex-col items-center justify-center bg-white slide-in-center text-center p-8">
                                <div className="mb-6 scale-110">
                                    <IconCheckCircle />
                                </div>
                                <h3 className="text-2xl font-bold text-gray-900 mb-2">결제가 완료되었습니다!</h3>
                                <p className="text-gray-500 mb-8">{orderInfo.merchant}</p>

                                <div className="w-full bg-gray-50 rounded-xl p-6 border border-gray-100 mb-8">
                                    <div className="flex justify-between mb-2">
                                        <span className="text-gray-500">결제 금액</span>
                                        <span className="font-bold text-[#03C75A]">{formatNum(orderInfo.amount)} NSC</span>
                                    </div>
                                    <div className="flex justify-between border-t border-gray-200 pt-2 mt-2">
                                        <span className="text-gray-500">남은 잔액</span>
                                        <span className="font-bold text-gray-800">{formatNum(orderInfo.userBalance - orderInfo.amount)} NSC</span>
                                    </div>
                                </div>

                                <button
                                    onClick={handleReset}
                                    className="w-full py-4 bg-gray-800 text-white rounded-xl font-bold hover:bg-gray-900 transition-colors"
                                >
                                    확인
                                </button>
                            </div>
                        )}

                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

</body>

</html>